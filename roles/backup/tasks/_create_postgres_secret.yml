---
- template:
    src: postgres-secret.yml.j2
    dest: /tmp/postgres-secret.yml
  vars:
    name: '{{ secret_name }}'
    user: '{{ secret_postgres_user }}'
    database: '{{ secret_postgres_database }}'
    host: '{{ secret_postgres_host }}'
    superuser: '{{ secret_postgres_superuser | default("false") }}'
    password: '{{ secret_postgres_password }}'

- name: Create Postgres secret {{ secret_name }}
  shell: oc create -f /tmp/postgres-secret.yml -n {{ backup_secret_namespace }}
  register: pg_secret_create
  failed_when: pg_secret_create.stderr != '' and 'AlreadyExists' not in pg_secret_create.stderr

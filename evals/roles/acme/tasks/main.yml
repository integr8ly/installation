---
- name: Create ACME namespace
  shell: oc new-project {{ acme_namespace }}
  register: acme_namespace_exists
  failed_when: acme_namespace_exists.stderr != '' and 'already exists' not in acme_namespace_exists.stderr
  changed_when: acme_namespace_exists.rc == 0

- name: Create ACME template
  shell: oc create -n {{ acme_namespace }} -f{{ acme_template }}
  register: cmd_acme_template
  failed_when: cmd_acme_template.stderr != '' and 'already exists' not in cmd_acme_template.stderr
  changed_when: cmd_acme_template.rc == 0

- name: Grant acme controller cluster role privileges to service account
  shell: oc adm policy add-cluster-role-to-user openshift-acme -n {{ acme_namespace }} -z openshift-acme

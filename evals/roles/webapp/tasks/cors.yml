---
- name: Add webapp route to corsAllowedOrigins in master config
  blockinfile:
    marker: "# {mark} GENERATED BY WEBAPP INSTALLER"
    path: "{{ webapp_openshift_master_config_path }}"
    insertafter: "corsAllowedOrigins"
    backup: yes
    block: |2
      - https://{{ hostvars['WEBAPP_VARS']['webapp_secure_route'] }}
  register: webapp_master_config_update
  become: yes

- name: restart openshift master services
  shell: "{{ webapp_master_restart_shim_path }} {{ item }}"
  become: yes
  when: webapp_master_config_update.changed
  with_items:
  - api
  - controllers
